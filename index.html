<!DOCTYPE html>
<html lang="zh-cn">

<head>

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0,
	maximum-scale=1.0, user-scalable=no"/>
<title>index</title>
<link rel="shortcut icon" href="pic/favicon.png"/>
<link rel="stylesheet" href="css/index.css"/>
<style type="text/css">
* {
	margin: 0;
	padding: 0;
}

body {
	text-rendering: optimizeLegibility;
	font-size: 16px;
	font-family: "-apple-system", "Helvetica Neue", "Roboto", "Segoe UI", sans-serif;
	overflow-x: hidden;
}

header {
	height: 45px;
	line-height: 45px;
	font-size: 18px;
	display: table;
	position: absolute;
	width: 100%;
	top: 0;
	left: 0;
	right: 0;
	text-align: center;
	font-weight: 500;
	border-color: #000;
	background-color: #444;
	color: #fff;
	transition: 1s;
}

header a {
	height: 45px;
	width: 45px;
	display: table-cell;
	position: absolute;
	top: 0;
	border: none;
	color: inherit;
	font-size: inherit;
	font-weight: inherit;
	background: rgba(0,0,0,0);
	cursor: pointer;
}

header a:focus {
	border: none;
}

header a:first-child {
	left: 0;
}

header a:last-child {
	right: 0;
}

header span {
	display: table-cell;
	white-space: nowrap;
}

#nav {
	position: fixed;
	top: 0;
	left: 0;
	bottom: 0;
	width: 0;
	display: flex;
	flex-flow: column nowrap;
	overflow-y: auto;
	background: #fcfcfc;
	box-shadow: inset -14px 0px 5px -12px rgb(210,210,210);
	border-right: 1px #444;
	transition: .5s;
}

#table-of-contents {
	margin-top: 45px;
	height: 100%;
	overflow: auto;
	list-style-type: none;
	color: #45a;
}

#table-of-contents ul {
	list-style-type: none;
}

#table-of-contents li {
	padding-left: 1em;
	line-height: 2em;
	/* both of the following are required for text-overflow */
	white-space: nowrap;
	overflow: hidden;
	text-overflow: ellipsis;
}

#table-of-contents ul li {
	color: black;
}

#table-of-contents ul li:hover {
	/*text-decoration: underline;*/
	background: #dde;
	cursor: pointer;
}

li.isnew::after {
	content: "NEW";
	color: red;
	font-size: 0.7em;
	padding: 0 0.3em;
}

#article {
	position: absolute;
	margin-left: 0;
	width: 100%;
	height: 100%;
	transition: .5s;
}

#iframe {
	display: table;
	padding: 0;
	border: 0;
	width: 100%;
	height: 100%;
}

#yinyang {
	transition: .5s;
}
</style>

</head>

<body>

<nav id="nav" hidden>
	<ul id="table-of-contents"></ul>
	<header>
		<a id="prev-article">&#x276e;</a>
		<span>目录</span>
		<a id="next-article">&#x276f;</a>
	</header>
</nav>

<article id="article">
	<iframe id="iframe"></iframe>
  <header id="header">
		<a id="yinyang">&#x262f;</a>
		<span id="article-title"></span>
		<a></a>
	</header>
</article>

<script src="js/table-of-contents.js"></script>
<script>
'use strict';
(function(){
// 假装在用 jquery
function $(str, innerHTML) {
	if (typeof(str) == 'string') {
		if (str[0] == '#')
			return document.getElementById(str.slice(1));
		else if (str.length > 0) {
			var elem = document.createElement(str);
			elem.innerHTML = innerHTML || '';
			return elem;
		}
  } else if (typeof(str) == 'undefined') {
    return document.createDocumentFragment();
  }
}

// elements
var article = $('#article'),
  artitle = $('#article-title'),
  header = $('#header'),
  iframe = $('#iframe'),
  nav = $('#nav'),
  toc = $('#table-of-contents'),
  yinyang = $('#yinyang'),
  prevArticle = $('#prev-article'),
  nextArticle = $('#next-article');

function hideNav(flag) {
	if (!nav.hidden || flag) {
		nav.hidden = true;
		nav.style.width = '0';
		article.style.marginLeft = '0';
		yinyang.style.transform = 'none';
	} else {
		nav.removeAttribute('hidden');
		nav.style.width = '16em';
		article.style.marginLeft = '16em';
		yinyang.style.transform = 'rotate(540deg)';
	}
}

function headerVisible(flag) {
	if (!nav.hidden || flag) {
		header.removeAttribute('hidden');
		header.style.opacity = '1';
	} else {
		header.hidden = true;
		header.style.opacity = '0';
	}
}

// load data & find pos
var src = localStorage['src'] || tableOfContents[0].articles[0].src;
var title = localStorage['title'] || tableOfContents[0].articles[0].title;
var pos = [0, 0];
for (var i = 0; i < tableOfContents.length; ++i) {
  for (var j = 0; j < tableOfContents[i].articles.length; ++j) {
    if (tableOfContents[i].articles[j].src == src) {
      pos = [i, j];
      break;
    }
  }
}
jump();

function jump() {
  localStorage['src'] = src;
  localStorage['title'] = title;
  iframe.setAttribute('src', src);
  artitle.innerHTML = title;
  hideNav(true);
  setTimeout(headerVisible, 1000);
}

function jumpto(i, j) {
  return function() {
    var item = tableOfContents[i].articles[j];
    src = item.src, title = item.title;
    pos = [i, j];
    jump();
  };
}

// render table of contents
var frag = $();
for (var i = 0; i < tableOfContents.length; ++i) {
	var LI = $('li', tableOfContents[i].title);
	var ul = $('ul');
	for (var j = 0; j < tableOfContents[i].articles.length; ++j) {
		var li = $('li', tableOfContents[i].articles[j].title);
		li.onclick = jumpto(i, j);
		if (tableOfContents[i].articles[j].isnew)
			li.classList.add('isnew');
		ul.appendChild(li);
	}
	LI.appendChild(ul);
	frag.appendChild(LI);
}
toc.appendChild(frag);

// bind event listener
header.onmouseover = function() {headerVisible(true)};
header.onmouseout = function() {headerVisible(false)};
yinyang.onclick = function() {hideNav()};
prevArticle.onclick = function() {
	if (pos[1] == 0) {
		if (pos[0] == 0) {
			console.warn('already at first article.');
			return;
		}
		pos[1] = tableOfContents[--pos[0]].articles.length;
	}
	--pos[1];
	jumpto(pos[0], pos[1])();
};

nextArticle.onclick = function() {
	if (pos[1] == tableOfContents[pos[0]].articles.length-1) {
		if (pos[0] == tableOfContents.length-1) {
			console.warn('no more articles.');
			return;
		}
		++pos[0];
		pos[1] = -1;
	}
	++pos[1];
	jumpto(pos[0], pos[1])();
};

})();
</script>

</body>

</html>
