<!DOCTYPE html>
<html lang="zh-cn">

<head>

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0,
	maximum-scale=1.0, user-scalable=no"/>
<title>index</title>
<link rel="shortcut icon" href="pic/favicon.png"/>
<link rel="stylesheet" href="css/index.css"/>
<style type="text/css">
* {
	margin: 0;
	padding: 0;
}

body {
	text-rendering: optimizeLegibility;
	font-size: 16px;
	font-family: "-apple-system", "Helvetica Neue", "Roboto", "Segoe UI", sans-serif;
	overflow-x: hidden;
}

header {
	height: 45px;
	line-height: 45px;
	font-size: 18px;
	display: table;
	position: absolute;
	width: 100%;
	top: 0;
	left: 0;
	right: 0;
	text-align: center;
	font-weight: 500;
	border-color: #000;
	background-color: #444;
	color: #fff;
	transition: 1s;
}

header button {
	height: 45px;
	width: 45px;
	display: table-cell;
	position: absolute;
	top: 0;
	border: 0;
	color: inherit;
	font-size: inherit;
	font-weight: inherit;
	background: rgba(0,0,0,0);
	cursor: pointer;
}

header button:first-child {
	left: 0;
}

header button:last-child {
	right: 0;
}

header span {
	display: table-cell;
	white-space: nowrap;
}

#nav {
	position: fixed;
	top: 0;
	left: 0;
	bottom: 0;
	width: 0;
	display: flex;
	flex-flow: column nowrap;
	overflow-y: auto;
	background: #fcfcfc;
	box-shadow: inset -14px 0px 5px -12px rgb(210,210,210);
	border-right: 1px #444;
	transition: .2s;
}

#table-of-contents {
	margin-top: 45px;
	height: 100%;
	overflow: auto;
	list-style-type: none;
	color: #45a;
}

#table-of-contents ul {
	list-style-type: none;
}

#table-of-contents li {
	padding-left: 1em;
	line-height: 2em;
}

#table-of-contents ul li {
	color: black;
}

#table-of-contents ul li:hover {
	/*text-decoration: underline;*/
	background: #dde;
	cursor: pointer;
}

#article {
	position: absolute;
	margin-left: 0;
	width: 100%;
	height: 100%;
	transition: .2s;
}

#iframe {
	display: table;
	padding: 0;
	border: 0;
	width: 100%;
	height: 100%;
}
</style>

</head>

<body>

<nav id="nav" hidden>
	<ul id="table-of-contents"></ul>
	<header>
		<button onclick="prevArticle()">&lt;</button>
		<span>目录</span>
		<button onclick="nextArticle()")>&gt;</button>
	</header>
</nav>

<article id="article">
	<iframe id="iframe"></iframe>
	<header id="header" onmouseover="headerVisible(true)"
						onmouseout="headerVisible(false)">
		<button onclick="hideNav()">&Xi;</button>
		<span id="article-title"></span>
		<button>+</button>
	</header>
</article>


<script src="js/table-of-contents.js"></script>
<script>
'use strict';
(function(){
function getQuery() {
	var ret = {};
	var argstr = window.location.href;
	var i = argstr.indexOf('?');
	if (i != -1) {
		var strs = argstr.substr(i+1).split("&");
		for (var i = 0; i < strs.length; ++i) {
			var splits = strs[i].split('=');
			// decodeURI() doesn't work
			ret[splits[0]] = unescape(splits[1]);
      }
   }
   return ret;
}

var args = getQuery();
var groupIdx = parseInt(args.group)-1
	|| parseInt(window.localStorage['groupIndex'+domain]) || 0;
var articleIdx = parseInt(args.article)-1
	|| parseInt(window.localStorage['articleIndex'+domain]) || 0;
var toc = document.getElementById('table-of-contents');
var iframe = document.getElementById('iframe');
var artitle = document.getElementById('article-title');
var nav = document.getElementById('nav');
var article = document.getElementById('article');
var header = document.getElementById('header');

function hideNav(flag) {
	if (!nav.hidden || flag) {
		nav.hidden = true;
		nav.style.width = '0';
		article.style.marginLeft = '0';
	} else {
		nav.removeAttribute('hidden');
		nav.style.width = '16em';
		article.style.marginLeft = '16em';
	}
}

function headerVisible(flag) {
	if (!nav.hidden || flag) {
		header.removeAttribute('hidden');
		header.style.opacity = '1';
	} else {
		header.hidden = true;
		header.style.opacity = '0';
	}
}

function jump() {
	iframe.setAttribute('src', tableOfContents[groupIdx].articles[articleIdx].src);
	artitle.innerHTML = tableOfContents[groupIdx].articles[articleIdx].title;
	window.localStorage['groupIndex'+domain] = groupIdx;
	window.localStorage['articleIndex'+domain] = articleIdx;
	hideNav(true);
	setTimeout(headerVisible, 1000);
}

function prevArticle() {
	if (articleIdx == 0) {
		if (groupIdx == 0) {
			console.warn('already at first article.');
			return;
		}
		articleIdx = tableOfContents[--groupIdx].articles.length;
	}
	--articleIdx;
	jump();
};

function nextArticle() {
	if (articleIdx == tableOfContents[groupIdx].articles.length-1) {
		if (groupIdx == tableOfContents.length-1) {
			console.warn('$no more articles.');
			return;
		}
		++groupIdx;
		articleIdx = -1;
	}
	++articleIdx;
	jump();
};

function jumpto(i, j) {
	return function() {
		groupIdx = i;
		articleIdx = j;
		jump();
	}
}

// load page
jump();

// load table of contents
var frag = document.createDocumentFragment();
for (var i = 0; i < tableOfContents.length; ++i) {
	var li0 = document.createElement('li');
	li0.innerHTML = tableOfContents[i].title;
	var ul = document.createElement('ul');
	for (var j = 0; j < tableOfContents[i].articles.length; ++j) {
		var li = document.createElement('li');
		li.innerHTML = tableOfContents[i].articles[j].title;
		li.onclick = jumpto(i, j);
		if (tableOfContents[i].articles[j].isnew) {
			var isnew = document.createElement('span');
			isnew.style.color = 'red';
			isnew.style.fontSize = '0.7em';
			isnew.style.padding = '0 0.3em';
			isnew.innerHTML = 'NEW';
			li.appendChild(isnew);
		}
		ul.appendChild(li);

	}
	li0.appendChild(ul);
	frag.appendChild(li0);
}
toc.appendChild(frag);

window.prevArticle = prevArticle;
window.nextArticle = nextArticle;
window.headerVisible = headerVisible;
window.hideNav = hideNav;
})();
</script>

</body>

</html>
