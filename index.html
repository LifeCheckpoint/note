<!DOCTYPE html>
<html lang="zh-cn">

<head>

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0,
  maximum-scale=1.0, user-scalable=no"/>
<title>index</title>
<link rel="shortcut icon" href="img/pikachu.png"/>
<link rel="stylesheet" href="css/yellow.css"/>
<style type="text/css">
* {
  margin: 0;
  padding: 0;
}

body {
  text-rendering: optimizeLegibility;
  font-size: 16px;
  font-family: "-apple-system", "Helvetica Neue", "Roboto", "Segoe UI", sans-serif;
  overflow-x: hidden;
}

header {
  height: 45px;
  line-height: 45px;
  font-size: 18px;
  display: table;
  position: absolute;
  width: 100%;
  top: 0;
  left: 0;
  right: 0;
  text-align: center;
  font-weight: 500;
  border-color: #000;
  background-color: #444;
  color: #fff;
  transition: 1s;
}

header a {
  height: 45px;
  width: 45px;
  display: table-cell;
  position: absolute;
  top: 0;
  border: none;
  color: inherit;
  font-size: inherit;
  font-weight: inherit;
  background: rgba(0,0,0,0);
  cursor: pointer;
}

header a:focus {
  border: none;
}

header a:first-child {
  left: 0;
}

header a:last-child {
  right: 0;
}

header span {
  display: table-cell;
  white-space: nowrap;
}

#nav {
  position: fixed;
  top: 0;
  left: 0;
  bottom: 0;
  width: 0;
  display: flex;
  flex-flow: column nowrap;
  overflow-y: auto;
  background: #fcfcfc;
  box-shadow: inset -14px 0px 5px -12px rgb(210,210,210);
  border-right: 1px #444;
  transition: .5s;
}

#table-of-contents {
  margin-top: 45px;
  height: 100%;
  overflow: auto;
  list-style-type: none;
  color: #45a;
}

#table-of-contents ul {
  list-style-type: none;
}

#table-of-contents li {
  padding-left: 1em;
  line-height: 2em;
  /* both of the following are required for text-overflow */
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

#table-of-contents ul li {
  color: black;
}

#table-of-contents ul li:hover {
  /*text-decoration: underline;*/
  background: #dde;
  cursor: pointer;
}

li.isnew::after {
  content: "NEW";
  color: red;
  font-size: 0.7em;
  padding: 0 0.3em;
}

#article {
  position: absolute;
  margin-left: 0;
  width: 100%;
  height: 100%;
  transition: .5s;
}

#iframe {
  display: table;
  padding: 0;
  border: 0;
  width: 100%;
  height: 100%;
}

#yinyang {
  transition: .5s;
}

#book-wrapper {
  display: inline-block;
  width: 50%;
}

#book-wrapper::after {
  position: absolute;
  right: 70px;
  top: 18px;
  content: "";
  border: 10px solid transparent;
  border-top-color: white;
  cursor: pointer;
}

#book {
  cursor: pointer;
  border: none;
  border-radius: 4px;
  color: inherit;
  background: inherit;
  background-image: none;
  height: 43px;
  width: 100%;
  font-size: inherit;
  text-align: center;
  -webkit-appearance: none;
  -moz-appearance: none;
}

#book:focus {
  outline: none;
}
</style>

</head>

<body>

<nav id="nav" hidden>
  <ul id="table-of-contents"></ul>
  <header>
    <a id="prev-article">&#x276e;</a>
    <div id="book-wrapper">
      <select name="book" id="book">
        <option value="math">数学</option>
        <option value="cs">计算机</option>
        <option value="physics">物理</option>
      </select>
    </div>
    <a id="next-article">&#x276f;</a>
  </header>
</nav>

<article id="article">
  <iframe id="iframe"></iframe>
  <header id="header">
    <a id="yinyang">&#x262f;</a>
    <span id="article-title"></span>
    <a></a>
  </header>
</article>

<script>
'use strict';
//(function(){
// 假装在用 jquery
function $(str, children) {
  if (typeof(str) == 'string') {
    var len = str.length;
    if (str[0] == '#')
      return document.getElementById(str.slice(1));
    if (str[0] == '.')
      return document.getElementsByClassName(str.slice(1));
    if (str[0] == '<' && str[len-1] == '>') {
      var elem = document.createElement(str.slice(1,len-1));
      if (typeof(children) == 'string')
        elem.innerHTML = children;
      else if (children instanceof Node)
        elem.appendChild(children);
      else if (children instanceof Array) {
        for (c of children)
          elem.appendChild(c);
      }
      return elem;
    }
    if (len > 0)
      return document.getElementsByTagName(str);
  }
  if (typeof(str) == 'undefined') {
    return document.createDocumentFragment();
  }
}

// elements
var article = $('#article'),
  artitle = $('#article-title'),
  header = $('#header'),
  iframe = $('#iframe'),
  nav = $('#nav'),
  toc = $('#table-of-contents'),
  yinyang = $('#yinyang'),
  prevArticle = $('#prev-article'),
  nextArticle = $('#next-article'),
  book = $('#book');

var tableOfContents;
var prefix;
var src, title;
var pos = [0,0];

function hideNav(flag) {
  if (!nav.hidden || flag) {
    nav.hidden = true;
    nav.style.width = '0';
    article.style.marginLeft = '0';
    yinyang.style.transform = 'none';
  } else {
    nav.removeAttribute('hidden');
    nav.style.width = '16em';
    article.style.marginLeft = '16em';
    yinyang.style.transform = 'rotate(540deg)';
  }
}

function headerVisible(flag) {
  if (!nav.hidden || flag) {
    header.removeAttribute('hidden');
    header.style.opacity = '1';
  } else {
    header.hidden = true;
    header.style.opacity = '0';
  }
}

function jump() {
  localStorage['src'] = src;
  iframe.setAttribute('src', prefix + '/' + src);
  artitle.innerText = title;
  hideNav(true);
  setTimeout(headerVisible, 1000);
}

function jumpto(i, j) {
  return function() {
    var item = tableOfContents[i].articles[j];
    src = item.src, title = item.title;
    pos = [i, j];
    jump();
  };
}

function getQuery() {
  var theRequest = new Object();
  var i = location.href.indexOf('?');
  if (i != -1) {
    var strs = location.href.substr(i+1).split("&");
    for (var i = 0; i < strs.length; ++i) {
      var splits = strs[i].split('=');
      // decodeURI() doesn't work
      theRequest[splits[0]] = unescape(splits[1]);
    }
  }
  return theRequest;
}

function loadBook() {
  prefix = book.value;
  if (prefix == 'math') {
    document.title = 'zmx0142857 的数学笔记';
    tableOfContents = [ {
      title:'示例',
      articles: [
        {title:'公式编辑器', src:'example/editor.html'},
        {title:'Asciimath', src:'example/asciimath.html'},
        {title:'Mathml', src:'example/mathml.html'},
      ]
    }, {
      title:'未分类',
      articles: [
        {title:'问题', src:'misc/0.html', isnew:true},
        {title:'有理数和代数数', src:'misc/1.html', isnew:true},
        {title:'三角函数', src:'misc/2.html'},
        {title:'不等式', src:'misc/3.html'},
        {title:'初等代数', src:'misc/4.html', isnew:true},
        {title:'因式分解', src:'misc/5.html'},
        {title:'数学家', src:'misc/6.html'},
        {title:'算术', src:'misc/7.html'},
      ]
    }, {
      title:'高等代数',
      articles: [
        {title:'矩阵', src:'algebra/1.html'},
        {title:'行列式', src:'algebra/2.html'},
        {title:'向量的相关性与线性方程组', src:'algebra/3.html'},
        {title:'线性空间', src:'algebra/4.html'},
        {title:'线性映射与线性变换', src:'algebra/5.html'},
        {title:'特征值与特征向量', src:'algebra/6.html'},
        {title:'矩阵的相似标准形', src:'algebra/7.html'},
        {title:'线性空间中的度量与内积', src:'algebra/8.html'},
        {title:'二次型', src:'algebra/9.html'},
      ]
    }, {
      title:'数学分析',
      articles: [
        {title:'附录', src:'analysis/0.html'},
        {title:'初等函数', src:'analysis/1.html'},
        {title:'数列的极限', src:'analysis/2.html'},
        {title:'函数的极限与连续性', src:'analysis/3.html'},
        {title:'导数的应用', src:'analysis/5.html', isnew:true},
        {title:'不定积分', src:'analysis/6.html'},
        {title:'定积分', src:'analysis/7.html'},
        {title:'特殊函数', src:'analysis/8.html', isnew:true},
        {title:'无穷级数', src:'analysis/10.html'},
        {title:'多元函数的极限与连续性', src:'analysis/14.html'},
        {title:'多元数量函数微分学', src:'analysis/15.html'},
        {title:'多元函数的极值', src:'analysis/17.html'},
        {title:'重积分', src:'analysis/19.html'},
        {title:'场论初步', src:'analysis/22.html'},
        {title:'分数阶微积分', src:'analysis/23.html', isnew:true},
        {title:'函数方程', src:'analysis/24.html', isnew:true},
      ]
    }, {
      title:'集合论与点集拓扑',
      articles: [
        //		{title:'数理逻辑初步', src:'set/1.html'},
        {title:'集合及其运算', src:'set/2.html'},
        {title:'二元关系与映射', src:'set/3.html'},
        {title:'基数', src:'set/6.html'},
      ]
    }, {
      title:'复变函数',
      articles: [
        {title:'复数与复变函数', src:'complex/1.html'},
        {title:'全纯函数', src:'complex/2.html', isnew:true},
      ]
    }, {
      title:'实变函数',
      articles: [
        {title:'预备知识', src:'real/1.html'},
        {title:'Lebesgue 测度', src:'real/2.html', isnew:true},
      ]
    }, {
      title:'概率论',
      articles: [
        {title:'事件与概率', src:'probability/1.html'},
        {title:'随机变量', src:'probability/2.html'},
        {title:'极限定理', src:'probability/4.html'},
        {title:'常用分布', src:'probability/5.html'},
      ]
    }, {
      title:'数理统计',
      articles: [
        {title:'数理统计的基本概念', src:'statistics/1.html'},
        {title:'参数估计与假设检验', src:'statistics/2.html'},
      ]
    }, {
      title:'数值分析',
      articles: [
        {title:'插值', src:'numeric/2.html'},
        {title:'线性方程组', src:'numeric/5.html'},
        {title:'矩阵', src:'numeric/6.html'},
        {title:'非线性方程数值解法', src:'numeric/7.html'},
        {title:'常微分方程数值解法', src:'numeric/8.html'},
        {title:'偏微分方程的 Ritz-Galerkin 方法', src:'numeric/9.html'},
      ]
    }, {
      title:'泛函分析',
      articles: [
        {title:'度量空间', src:'functional/1.html'},
        {title:'线性赋范空间', src:'functional/2.html'},
        {title:'有界线性算子', src:'functional/3.html'},
        {title:'Hilbert 空间及其上的有界线性算子', src:'functional/4.html'},
      ]
    }, {
      title:'抽象代数',
      articles: [
        {title:'群 (上)', src:'abstract/2.html'},
        {title:'群 (中)', src:'abstract/3.html'},
        {title:'群 (下)', src:'abstract/4.html'},
        {title:'半群', src:'abstract/5.html'},
        {title:'环', src:'abstract/6.html'},
        {title:'域', src:'abstract/7.html'},
      ]
    }, {
      title:'拓扑学',
      articles: [
        {title:'拓扑空间与连续映射', src:'topology/1.html'},
      ]
    }, {
      title:'常微分方程',
      articles: [
        {title:'一阶微分方程的初等解法', src:'ode/2.html'},
        {title:'高阶微分方程', src:'ode/4.html'},
        {title:'线性微分方程组', src:'ode/5.html'},
      ]
    }, {
      title:'偏微分方程',
      articles: [
        {title:'方程的导出', src:'pde/1.html'},
        {title:'波动方程', src:'pde/2.html'},
        {title:'热传导方程', src:'pde/3.html'},
        {title:'位势方程', src:'pde/4.html'},
        {title:'二阶线性偏微分方程的分类', src:'pde/5.html'},
      ]
    }, {
      title:'初等几何',
      articles: [
        {title:'五组公理', src:'geometry/1.html'},
        {title:'三角形', src:'geometry/3.html', isnew:true},
        {title:'四边形', src:'geometry/4.html', isnew:true},
        {title:'抛物线', src:'geometry/5.html'},
      ]
    }, {
      title:'解析几何',
      articles: [
        {title:'向量与坐标系', src:'analytic-geo/1.html'},
        {title:'平面与直线', src:'analytic-geo/2.html'},
        {title:'二次曲线与曲面', src:'analytic-geo/3.html'},
        {title:'平面几何的复数解法', src:'analytic-geo/6.html'},
      ]
    }, {
      title:'微分几何',
      articles: [
        {title:'欧氏空间', src:'diff-geo/1.html'},
        {title:'曲线的局部理论', src:'diff-geo/2.html'},
        {title:'曲面的局部理论', src:'diff-geo/3.html'},
        {title:'标架与曲面论基本定理', src:'diff-geo/4.html'},
        {title:'曲面的内蕴几何学', src:'diff-geo/5.html'},
      ]
    }, {
      title:'数论',
      articles: [
        {title:'整除', src:'number/1.html'},
        {title:'不定方程', src:'number/5.html', isnew:true},
        {title:'Bernoulli 数与 Riemann zeta 函数', src:'number/10.html', isnew:true},
      ]
    }, {
      title:'组合数学',
      articles: [
        {title:'组合数学', src:'combinatorics/1.html'},
        {title:'排列与组合', src:'combinatorics/2.html'},
        {title:'求解递推式', src:'combinatorics/3.html'},
        {title:'容斥原理', src:'combinatorics/5.html'},
      ]
    }, {
      title:'图论',
      articles: [
        {title:'Paths and cycles', src:'graph/2.html'},
      ]
    }, {
      title:'数学游戏',
      articles: [
        {title:'数学游戏', src:'recreation/1.html'},
      ]
    }];
  } else if (prefix == 'cs') {
    document.title = 'zmx0142857 的计算机笔记';
    tableOfContents = [ {
      title:'数据结构',
      articles: [
        {title:'数据结构习题', src:'ds/exercise.html'},
        {title:'绪论', src:'ds/1.html'},
        {title:'线性表', src:'ds/2.html'},
        {title:'栈与队列', src:'ds/3.html'},
        {title:'递归与回溯', src:'ds/4.html'},
        {title:'字符串', src:'ds/5.html'},
        {title:'树与二叉树', src:'ds/6.html'},
        {title:'矩阵与广义表', src:'ds/7.html'},
        {title:'图', src:'ds/8.html'},
        {title:'查找', src:'ds/9.html'},
        {title:'内排序', src:'ds/10.html'},
        {title:'外排序', src:'ds/11.html'},
        {title:'文件', src:'ds/12.html'},
        {title:'数论算法', src:'ds/13.html'},
      ]
    }, {
      title:'操作系统',
      articles: [
        {title:'引论', src:'os/1.html'},
        {title:'进程', src:'os/2.html'},
        {title:'内存', src:'os/3.html'},
      ]
    },{
      title:'计算机组成原理',
      articles: [
        {title:'计算机系统概论', src:'com/1.html'},
      ]
    },{
      title:'数据库系统概论',
      articles: [
        {title:'绪论', src:'db/1.html'},
        {title:'关系数据库', src:'db/2.html'},
        {title:'SQL', src:'db/3.html'},
        {title:'数据库习题', src:'db/exercise.html'},
      ]
    },{
      title:'计算机网络',
      articles: [
        {title:'概述', src:'net/1.html'},
        {title:'物理层', src:'net/2.html'},
      ]
    }, {
      title:'工具',
      articles: [
        {title:'svg 流程图', src:'tool/svg-flowchart.html'},
        {title:'模拟考试', src:'tool/exam.html'},
      ]
    }];
  } else if (prefix == 'physics') {
    document.title = 'zmx0142857 的物理笔记';
    tableOfContents = [];
  }

  // render table of contents
  var newtoc = $('<ul>');
  var frag = $();
  for (var i = 0; i < tableOfContents.length; ++i) {
    var LI = $('<li>', tableOfContents[i].title);
    var ul = $('<ul>');
    for (var j = 0; j < tableOfContents[i].articles.length; ++j) {
      var li = $('<li>', tableOfContents[i].articles[j].title);
      li.onclick = jumpto(i, j);
      if (tableOfContents[i].articles[j].isnew)
        li.classList.add('isnew');
      ul.appendChild(li);
    }
    LI.appendChild(ul);
    frag.appendChild(LI);
  }
  newtoc.appendChild(frag);
  nav.replaceChild(newtoc, toc);
  newtoc.id = 'table-of-contents';
  toc = newtoc;
}

// bind event listener
header.onmouseover = function() {headerVisible(true)};
header.onmouseout = function() {headerVisible(false)};
yinyang.onclick = function() {hideNav()};
prevArticle.onclick = function() {
  if (pos[1] == 0) {
    if (pos[0] == 0) {
      console.warn('already at first article.');
      return;
    }
    pos[1] = tableOfContents[--pos[0]].articles.length;
  }
  --pos[1];
  jumpto(pos[0], pos[1])();
};

nextArticle.onclick = function() {
  if (pos[1] == tableOfContents[pos[0]].articles.length-1) {
    if (pos[0] == tableOfContents.length-1) {
      console.warn('no more articles.');
      return;
    }
    ++pos[0];
    pos[1] = -1;
  }
  ++pos[1];
  jumpto(pos[0], pos[1])();
};

book.onchange = function() {
  loadBook();
  src = tableOfContents[0].articles[0].src;
  title = tableOfContents[0].articles[0].title;
  pos = [0,0];
  jump();
}

// load data & find pos
loadBook();
var args = getQuery();
if (args.g && args.a) {
  src = args.g + '/' + args.a + '.html'; 
} else {
  src = localStorage['src'] || tableOfContents[0].articles[0].src;
}
pos = [0, 0];
for (var i = 0; i < tableOfContents.length; ++i) {
  for (var j = 0; j < tableOfContents[i].articles.length; ++j) {
    if (tableOfContents[i].articles[j].src == src) {
      pos = [i, j];
    title = tableOfContents[i].articles[j].title;
      break;
    }
  }
}
jump();


//})();
</script>

</body>

</html>
