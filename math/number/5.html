<!DOCTYPE html>
<html lang="zh-cn">

<head>

<title>不定方程</title>
<meta charset="utf-8" />

<link rel="stylesheet" type="text/css" href="../css/note.css" />

</head>

<body>

<p class="example">
	解关于 `x, y` 的不定方程 `a x y+b x+c y+d = 0`, `a, b, c, d` 为整数.
</p>

<p class="solution">
	两边同乘 `a` 以后变形为
	<span class="formula">
		`(a x+c)(a y+b) = b c-a d`,
	</span>
	再讨论 `b c-a d` 的因子即可.
</p>

<p class="example">
	解关于 `a, b, c, d` 的不定方程 `1/a + 1/b + 1/c + 1/d = 1`,
	`a, b, c, d` 是两两不相等的正整数.
</p>

<p class="example">
	解关于 `x, y` 的不定方程 `x^2 + 615 = 2^y`.
</p>

<ol class="solution">
	<li>模 2: 
		显然 `y` 只能是正整数, 于是 `2^y` 是偶数. 这推出方程左边是偶数,
		于是 `x` 是奇数.
	</li>
	<li>模 3: `2^y` 不是 3 的倍数, 但 615 是 3 的倍数, 于是 `x` 不是
		3 的倍数.
	</li>
	<li>模 6: 综上可知 `x = 6n+-1`, 于是 `x^2 -= 1 (mod 6)`.
		而 `615 -= 3 (mod 6)`, 得到 `2^y -= 4(mod 6)`. 这推出 `y` 是偶数.
	</li>
	<li>设 `y = 2n`, 原方程变形为
		<span class="formula">
			`(2^n - x)(2^n + x) = 615 = 3*5*41`,
		</span>
		我们只需寻找 `(a, b)` 满足 `a + b = 2^(n+1)`, 其中 `a, b in {3, 5,
		41}`. 容易发现只有两组解 `(a, b) = (5, 123)` 或 `(123, 5)`.
		于是
		<span class="formula">
			`2^n +- x = 5`, `quad 2^n &pm; x = 123`.
		</span>
		解得 `n = 6`, (于是 `y = 12`), `x = +-59`.
	</li>
</ol>



<h2>勾股数</h2>

<p class="definition">
	由熟知的勾股定理 (Pythagorean theorem), 直角三角形的三边长 `a, b, c`
	满足
	<span class="formula">
		`a^2+b^2=c^2`.
	</span>
	我们称满足上述不定方程的正整数 `a, b, c` 为一组<b>勾股数
	(Pythagorean triple)</b>, 如 `(3, 4, 5)`, `(5, 12, 13)`,
	`(7, 24, 25)` 等. 以勾股数为边长的直角三角形叫勾股三角形.
	注意到像 `(3, 4, 5)` 与 `(6, 8, 10)` 是本质相同的勾股数, 故定义勾股数
	`a, b, c` 是<b>本原</b>的, 如果 `gcd(a, b, c) = 1`.
</p>

<p class="proposition">
	全体本原勾股数与单位圆在第一象限上的有理点一一对应.
</p>

<p class="proof">
	方程两边同除以 `c^2` 得
	<span class="formula">
		`(a/c)^2 + (b/c)^2 = 1`,
	</span>
	这说明 `(a/c, b/c)` 是单位圆周上的点; 反之设 `(p, q)`
	是单位圆上的有理点, 其中 `p, q` 是最简分数,
	用它们分母的最小公倍数通分得到
	`(p, q) = (a/c, b/c)`, 从而对应于勾股数 `(a, b, c)`.
	容易说明 `(a, b, c)` 是本原的.
</p>

<p> 在第一象限的单位圆周上任取一点 `P(x_P, y_P)`. 又设 `A(-1, 0)`,
	`k` 是 `AP` 的斜率, 则 `P` 点坐标和 `k` 的值一一对应.
	显然 `P` 是有理点时, `k` 是 `(0,1)` 中的一个有理数;
	下面证明 `k` 是 `(0,1)` 中的有理数时, 点 `P` 必为有理点.
	于是只要让斜率 `k` 取遍集合 `(0,1) nn QQ`,
	就得到单位圆在第一象限的全部有理点,
	从而得到全体本原勾股数.
</p>

<p class="proposition">
	设 `AP` 的斜率是 `v/u`, 整数 `u gt v gt 0`, 则 `P` 是有理点.
	事实上, 设 `P` 在横轴的投影为 `Q(x_P, 0)`,
	则 `triangle OQP` 相似于边长分别为 `u^2-v^2, 2u v, u^2+v^2`
	的勾股三角形.
</p>

<p class="proof">
	<span class="img" style="height:30em">
		<img src="../img/pythagorean-triple.svg" />
	</span>
	只要求出 `P` 的坐标即可, 这里用复数来处理.
	由已知, `"arg"(u+"i"v) = /_ PAQ`, 将这个复数平方,
	就得到一个具有两倍辐角的复数
	`(u+"i"v)^2 = u^2-v^2 + 2u v"i"`.
	因为同弧所对的圆心角是圆周角的两倍, 我们有
	<span class="formula">
		`"arg"(u+"i"v)^2 = /_ POQ`.
	</span>
	又
	<span class="formula">
		`|(u+"i"v)^2|`
		`= |u+"i"v|^2`
		`= u^2+v^2`.
	</span>
	利用三角形相似得到 `x_P = (u^2-v^2)/(u^2+v^2)`,
	`y_P = (2u v)/(u^2+v^2)`, 所以 `P` 是有理点.
</p>

<p class="remark">
	可以用代数计算验证, 确实有
	<span class="formula">
		`(u^2-v^2)^2 + (2u v)^2 = (u^2+v^2)^2`.
	</span>
	由以上讨论知, 任意一个勾股三角形总是相似于边长为
	`u^2-v^2, 2u v, u^2+v^2` 的三角形, 其中 `u gt v gt 0`.
	代入 `(u,v) = (2,1)` 得到勾股数 `(3, 4, 5)`, 代入 `(u,v) = (3,2)`
	得到勾股数 `(5,12,13)`... 试试看吧!
</p>

<h2>四平方和定理</h2>

<a href="https://baike.baidu.com/item/%E5%9B%9B%E5%B9%B3%E6%96%B9%E5%92%8C%E5%AE%9A%E7%90%86?bk_fr=chain_bottom&timestamp=1568187163118">原文来自百度百科</a>

<p class="theorem">
	<b>Lagrange 恒等式</b>
	设 `n in ZZ^+`, `x_i, y_i in RR`, `i = 1, 2, cdots, n`, 则
	<span class="formula">
		`(sum_(i=1)^n x_i^2)(sum_(i=1)^n y_i^2)`
		`= (sum_(i=1)^n x_i y_i)^2
		+ sum_(1 le i lt j le n) (x_i y_j - x_j y_i)^2`.
	</span>
</p>

<p class="proof">
	<span class="formula">
		右边
		`= sum_(i=1)^n x_i^2 y_i^2 + 2 sum_(1 le i lt j le n) x_i y_i x_j
		y_j + sum_(1 le i lt j le n) x_i^2 y_j^2`
		`- 2 sum_(1 le i lt j le n) x_i y_j x_j y_i
		+ sum_(1 le i lt j le n) x_j^2 y_i^2`
		`= sum_(i=1)^n x_i^2 y_i^2 + sum_(1 le i lt j le n) x_i^2
		y_j^2 + sum_(1 le i lt j le n) x_j^2 y_i^2 =`左边.
	</span>
</p>

<p class="corollary">
	<b>二平方和恒等式</b>
	<span class="formula">
		`(x_1^2+x_2^2)(y_1^2+y_2^2)
		= (x_1 y_1+x_2 y_2)^2 + (x_1 y_2-x_2 y_1)^2`.
	</span>
	可以从向量的角度理解:
	<span class="formula">
		`|bm x|^2 |bm y|^2 = |bm x * bm y|^2 + |bm x xx bm y|^2`.
	</span>
	从而, 如果整数 `m, n` 能表示为两个整数的平方之和,
	则 `mn` 也能.
</p>

<p class="corollary">
	<b>四平方和恒等式</b> (Euler, 1743)
	<span class="formula">
		`(sum_(i=1)^4 x_i^2)(sum_(i=1)^4 y_i^2) = sum_(i=1)^4 z_i^2`.
	</span>
	其中
	<span class="formula">
		`z_1 = x_1 y_1 + x_2 y_2 + x_3 y_3 + x_4 y_4`,<br/>
		`z_2 = x_1 y_2 - x_2 y_1 + x_3 y_4 - x_4 y_3`,<br/>
		`z_3 = x_1 y_3 - x_3 y_1 + x_4 y_2 - x_2 y_4`,<br/>
		`z_4 = x_1 y_4 - x_4 y_1 + x_2 y_3 - x_3 x_2`.
	</span>
	从而, 如果整数 `m, n` 能表示为四个整数的平方之和,
	则 `mn` 也能.
</p>

<p class="proof">
	由 Lagrange 恒等式, 只需验证
	<span class="formula">
		`(x_1 y_2 - x_2 y_1)(x_3 y_4 - x_4 y_3)`
		`- (x_1 y_3 - x_3 y_1)(x_2 y_4 - x_4 y_2)`
		`+ (x_1 y_4 - x_4 y_2)(x_2 y_3 - x_3 y_2) = 0`.
	</span>
	即可. 上式的左边可由 Laplace 定理展开行列式
	<span class="formula">
		`|x_1,x_2,x_3,x_4;
		  y_1,y_2,y_3,y_4;
		  x_1,x_2,x_3,x_4;
		  y_1,y_2,y_3,y_4|`
	</span>
	得到.
</p>

<p class="lemma" id="lem-4-square-odd-prime">
	(Euler, 1751) 对任意奇素数 `p`, 同余方程
	<span class="formula">
		`x^2+y^2+1 = 0` `(mod p)`
	</span>
	存在整数解 `0 le x, y lt p//2`.
	因此对任意奇素数 `p`, 存在正整数 `m` 和整数 `0 le x, y le (p-1)//2`,
	使得
	<span class="formula">
		`m p = x^2 + y^2 + 1 le (p-1)^2//2 + 1`
		`lt (p-1)(p+1) + 1 = p^2`.
	</span>
	因此 `m lt p`.
</p>

<p class="proof">
	模 `p` 的二次剩余 (即全体平方数 `ZZ^2` 模 `p` 的同余类)
	有 `(p+1)//2` 个, 分别为
	<span class="formula">
		`0, 1^2, 2^2, cdots, ((p-1)/2)^2`.
	</span>
	若 `(p-1)//2` 是模 `p` 的二次剩余, 则存在 `0 le x lt p//2`
	使得 `x^2 -= (p-1)//2` `(mod p)`, 于是 `1 + x^2 + x^2 -= 0` `(mod p)`,
	定理得证.<br/>
	若 `(p-1)//2` 不属于模 `p` 的二次剩余,
	将模 `p` 的剩余 (即全体整数模 `p` 的同余类)
	分为如下 `(p-1)//2` 组:
	<span class="formula">
		`{0, p-1}, {1, p-2}, cdots, {(p-1)/2, (p-1)/2}`.
	</span>
	而模 `p` 的 `(p+1)//2` 个二次剩余必然落在前 `(p-3)//2` 组当中.
	由鸽巢原理, 必有两个二次剩余落在同一组中. 由于每一组的两个元素
	`m, n` 满足 `m + n + 1 -= 0` `(mod p)`,
	故存在整数 `x, y`, `0 le x, y lt p/2`,
	使 `x^2 + y^2 + 1 -= 0` `(mod p)`.
</p>

<p class="theorem">
	<b>四平方和定理</b>
	(Lagrange, 1770; Euler, 1773)
	任何非负整数都可以表示为四个整数的平方之和, 即不定方程
	<span class="formula">
		`x_1^2 + x_2^2 + x_3^2 + x_4^2 = n`, `quad n in ZZ^+ uu {0}`
	</span>
	恒有整数解.
</p>

<ol class="proof">
	<li>显然定理对 `n = 0, 1, 2` 成立:
		<span class="formula">
			`0 = 0^2 + 0^2 + 0^2 + 0^2`,<br/>
			`1 = 0^2 + 0^2 + 0^2 + 1^2`,<br/>
			`2 = 0^2 + 0^2 + 1^2 + 1^2`.
		</span>
		从而由四平方和恒等式知, 只需证定理对任意奇素数成立.
		又由<a class="ref" href="#lem-4-square-odd-prime"></a>,
		对任意奇素数 `p`, 存在正整数 `m` 使得 `m p`
		能表示为四个整数的平方和, 且 `m lt p`.
		不妨设 `m` 是这些整数中最小的, 且
		<span class="formula">
			`m p = x_1^2 + x_2^2 + x_3^2 + x_4^2`.
		</span>
	</li>
	<li>下证 `m` 不是偶数, 否则 `m p` 为偶数, `x_i, i = 1, 2, 3, 4`
		中的奇数只能是偶数个 (即 0, 2, 4 个).
		不失一般性, 设 `x_1, x_2` 奇偶性相同, 且 `x_3, x_4` 奇偶性相同, 则
		`x_1+-x_2`, `x_3+-x_4` 均为偶数, 得到
		<span class="formula">
			`(m p)/2 = ((x_1+x_2)/2)^2 + ((x_1-x_2)/2)^2`
			`+ ((x_3+x_4)/2)^2 + ((x_3-x_4)/2)^2`.
		</span>
		从而有 `m/2 lt m` 使得 `(m p)/2` 被表示为四个整数的平方和,
		与 `m` 的最小性矛盾.
	</li>
	<li>下证 `m = 1`. 我们反设 `m gt 1`.
		首先, `m` 不是 `x_1, x_2, x_3, x_4` 的公因数,
		否则有 `m^2 | m p rArr m | p`, 一个矛盾.
		故存在不全为零, 且绝对值小于 `m//2` (注意 `m` 是奇数) 的整数
		`y_i`, `i = 1, 2, 3, 4`, 使得
		<span class="formula">
			`y_i -= x_i` `(mod m)`, `quad i = 1, 2, 3, 4`.
		</span>
		(取 `y_i` 为 `x_i` 除以 `m` 的绝对最小余数即可). 因此
		<span class="formula">
			`0 lt sum_(i=1)^4 y_i^2 lt 4(m/2)^2 = m^2`,
		</span>
		且
		<span class="formula">
			`sum_(i=1)^4 y_i^2 -= sum_(i=1)^4 x_i^2 -= 0` `(mod m)`
		</span>
		从而
		<span class="formula">
			`sum_(i=1)^4 y_i^2 = m q`,
		</span>
		其中整数 `q` 满足 `0 lt q lt m`.
	</li>
	<li>下证 `p q` 可以表示成四个整数的平方和, 从而推翻假设.
		由四平方和恒等式, 令
		<span class="formula">
			`sum_(i=1)^4 z_i^2 = (sum_(i=1)^4 x_i^2) (sum_(i=1)^4 y_i^2)
			= m^2 p q`,
		</span>
		其中
		<span class="formula">
			`z_1 = x_1 y_1 + x_2 y_2 + x_3 y_3 + x_4 y_4`,<br/>
			`z_2 = x_1 y_2 - x_2 y_1 + x_3 y_4 - x_4 y_3`,<br/>
			`z_3 = x_1 y_3 - x_3 y_1 + x_4 y_2 - x_2 y_4`,<br/>
			`z_4 = x_1 y_4 - x_4 y_1 + x_2 y_3 - x_3 x_2`.
		</span>
		由 `x_i -= y_i (mod m)`, `i = 1, 2, 3, 4`, 有
		<span class="formula">
			`z_1 -= sum_(i=1)^4 x_i^2 -= 0` `(mod m)`.<br/>
			`z_i -= 0`, `i = 2, 3, 4`.
		</span>
		设 `z_i = m t_i`, `i = 1, 2, 3, 4`, 则
		<span class="formula">
			`p q = sum_(i=1)^4 t_i^2`,
		</span>
		但 `q lt m`, 与 `m` 的最小性矛盾. 证毕.
	</li>
</ol>

<h2>椭圆曲线</h2>

<p class="example">
	设直线 `y = k x + c` 与椭圆曲线 `y^2 = x^3 + a x + b`
	交于 `P_i(x_i, y_i)` `(i = 1, 2, 3)` 三点 (当其中两点重合时,
	直线与曲线相切). 联立方程, 由 Vieta 定理知
	<span class="formula">
		`x_1 + x_2 + x_3 = k^2`.
	</span>
	于是当已知 `P_1`, `P_2` 时, `P_3` 的坐标为
	<span class="formula">
		`x_3 = k^2 - x_1 - x_2`,
		`quad y_3 = y_1 + k(x_3-x_1)`<br/>
		(也可以是 `y_3 = y_2 + k(x_3-x_2)`.
	</span>
	称 `P_3` 关于 `x` 轴的对称点 `Q` 为 `P_1` 与 `P_2` 的和, 记为
	`Q = P_1 + P_2`.
	椭圆曲线上的全体有理点关于这一 "加法" 构成 Abel 群.
</p>

<p class="example">
	求关于 `a, b, c` 的不定方程
	<span class="formula">
		`a/(b+c) + b/(c+a) + c/(a+b) = 4`
	</span>
	的一组正整数解.
</p>

<p class="solution">
	[题源: <a href="https://zhuanlan.zhihu.com/p/33853851">知乎专栏</a>]
	此题可以通过椭圆代数曲线的理论解决.  一组可能的解是
	<span class="formula">
		a=154476802108746166441951315019919837485664325669565431700026634898253202035277999,<br/>
		b=36875131794129999827197811565225474825492979968971970996283137471637224634055579,<br/>
		c=4373612677928697257861252602371390152816537558161613618621437993378423467772036.
	</span>
	首先该方程是齐次的: 若 `(a,b,c)` 是解, 则 `(t a, t b, t c)` 也是解.
	方程变形为
	<span class="formula">
		`a^3+b^3+c^3 = 3(a^2 b+a b^2+a^2 c+a c^2+b^2 c+b c^2) + 5abc`.
	</span>
	作代换 (??)
	<span class="formula">
		`a = (56-x+y)/(56-14x)`,
		`quad b = (56-x-y)/(56-14x)`,
		`quad c = (-28-6x)/(28-7x)`,
	</span>
	即
	<span class="formula">
		`x = -28(a+b+2c)/(6a+6b-c)`,
		`quad y = 364(a-b)/(6a+6b-c)`,
	</span>
	方程化为
	<span class="formula">
		`gamma: quad y^2 = x^3 + 109 x^2 + 224 x`.
	</span>
	代数曲线 `gamma` 上存在有理点 `P = (-100, 260)`.
	过 `P` 作 `gamma` 的切线, 与 `gamma` 交于另一点 `Q`, 点 `Q` 关于 `x`
	轴的对称点记为 `2P`:
	<span class="formula">
		2P = P + P = (8836/25, -950716/125)
	</span>
	连接 `P` 与 `2P` 两点, 所得直线与 `gamma` 交于另一点, 该点关于 `x`
	轴的对称点记为 `3P`:
	<span class="formula">
		3P = P + 2P = (-731025/11881, 527529870/1295029)
	</span>
	类似得到
	<span class="formula">
		6P = 3P + 3P = (252785840525963937198721/13225347684085115955600, -343764653760831645784970282294394569/1520934975898868459000385442296000),
	</span>
	<span class="formula">
	9P = 3P + 6P = (-66202368404229585264842409883878874707453676645038225/13514400292716288512070907945002943352692578000406921, 58800835157308083307376751727347181330085672850296730351871748713307988700611210/1571068668597978434556364707291896268838086945430031322196754390420280407346469).
	</span>
	将 `9P` 这一点代回原变元 a, b, c:
	<span class="formula">
		(a,b,c) = (652194680638776317370751188686261401138670498641722947/826345176768069653846031682295795260307016241032351542, 72627067629030455550043880234643101653454184810448427/385489402115598358968822193146517732601759618776822382, 18811002229321433251069036843190834369329875858835562/841819787025663175191882291647234536827567920526661363).
	</span>
	放大适当倍数即得答案.
</p>

</body>

<script src="../js/note.js?type=math"></script>

</html>
