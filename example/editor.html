<!DOCTYPE html>
<html lang="en-us">
<head>

<title>公式编辑器</title>
<meta charset="utf-8"/>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"/>
<link rel="stylesheet" href="../css/note.css"/>
<style type="text/css">
div {
	padding: 10px 0;
}
#input {
	width: 100%;
	margin: 15px 0;
}
#outputWrapper {
	margin-top: 45px;
}
#outputWrapper > div {
	text-align: center;
	overflow-x: scroll;
}
@media print {
	#outputWrapper > div {
		border: none !important;
	}
	#inputWrapper {
		display: none;
	}
}
</style>
</head>
<body>

<div id="outputWrapper"></div>

<div id="inputWrapper">
	<button id="copyTex">copy tex</button>
	<button id="newFormula">new</button>
	<button id="deleteFormula">delete</button>
	<textarea id="input" rows="5"></textarea>
</div>

<script src="../js/AMsymbols.js"></script>
<script src="../js/asciimath-katex.js"></script>
<script src="../js/katex.min.js"></script>
<script>
var count = 0;
var input = document.getElementById('input');
var output;
var outputWrapper = document.getElementById('outputWrapper');

function render() {
	output.asciimath = input.value;
	output.innerHTML = '`' + output.asciimath + '`';
	if (typeof(AMTEX) != "undefined") {
		AMTEX();
		// texstring comes from asciimath-katex.js
		output.tex = texstring;
	}
} 	 

input.onkeyup = function(event) {
	if (event.keyCode || event.which)
		render();
};

copyTex.onclick = function() {
	var textArea = document.createElement('textarea');
	textArea.innerHTML = output.tex || '';
	document.body.appendChild(textArea);
	textArea.select();
	document.execCommand('copy');
	document.body.removeChild(textArea);
}

function highlight(elem) {
	if (output) output.style.border = 'none';
	elem.style.border = '1px solid #aaa';
	output = elem;
	input.value = output.asciimath || '';
	input.focus();
}

deleteFormula.onclick = function() {
	var formulae = outputWrapper.children;
	if (formulae.length > 1) {
		outputWrapper.removeChild(output);
		highlight(formulae[formulae.length-1]);
	}
}

newFormula.onclick = function() {
	var div = document.createElement('div');
	div.onclick = function() {
		highlight(div);
	}
	highlight(div);
	outputWrapper.appendChild(div);
}

newFormula.onclick();
input.value = 'x = (-b+-sqrt(b^2-4ac))/(2a)';
render();
render();
console.log('done');
</script>
</body>
</html>
